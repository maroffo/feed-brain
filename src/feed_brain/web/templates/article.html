{% extends "base.html" %}
{% block title %}{{ article.title }} - feed-brain{% endblock %}
{% block content %}
<article>
    <header>
        <div class="card-meta">
            {% if article.tier %}
            <span class="badge tier-{{ article.tier }}">{{ article.tier | tier_label }}</span>
            {% endif %}
            {% if article.category %}
            <span class="badge category">{{ article.category | category_label }}</span>
            {% endif %}
            {% if article.source_name %}
            <span class="source">{{ article.source_name }}</span>
            {% endif %}
        </div>
        <h2>{{ article.title }}</h2>
        {% if article.author %}
        <p class="author">by {{ article.author }}</p>
        {% endif %}
        <p><a href="{{ article.url }}" target="_blank" rel="noopener">Original article ‚Üó</a></p>
    </header>

    <nav class="article-actions-bar">
        <div class="feedback-buttons feedback-group-{{ article.id }}">
            {% if article.feedback == "approved" %}
            <span class="feedback-done">Clipping created</span>
            {% elif article.feedback == "skipped" %}
            <span class="feedback-done">Skipped</span>
            {% else %}
            <button hx-post="/article/{{ article.id }}/feedback?feedback=approved"
                    hx-target=".feedback-group-{{ article.id }}"
                    hx-swap="outerHTML"
                    class="btn-sm outline contrast">üëç Approve</button>
            <button hx-post="/article/{{ article.id }}/feedback?feedback=skipped"
                    hx-target=".feedback-group-{{ article.id }}"
                    hx-swap="outerHTML"
                    class="btn-sm outline contrast">üëé Skip</button>
            {% endif %}
        </div>
        <div class="nav-links">
            {% if prev_id %}
            <a href="/article/{{ prev_id }}{{ tier_param }}" role="button" class="outline contrast btn-sm">‚Üê Prev</a>
            {% endif %}
            <a href="/{{ '?tier=' + tier_filter if tier_filter else '' }}" role="button" class="outline contrast btn-sm">Feed</a>
            {% if next_id %}
            <a href="/article/{{ next_id }}{{ tier_param }}" role="button" class="outline contrast btn-sm">Next ‚Üí</a>
            {% endif %}
        </div>
    </nav>

    {% if article.summary %}
    <aside class="ai-analysis">
        <div class="summary-section">
            <h6 class="ai-label">AI Summary</h6>
            <p>{{ article.summary }}</p>
        </div>
        {% if article.money_quote %}
        <div class="quote-section">
            <h6 class="ai-label">Money Quote</h6>
            <blockquote class="money-quote">"{{ article.money_quote }}"</blockquote>
        </div>
        {% endif %}
        {% if article.actionables %}
        <div class="actionables-section">
            <h6 class="ai-label">Actionable Takeaways</h6>
            <ul class="actionables-list">
                {% for item in article.actionables %}
                <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        {% if article.reason %}
        <details class="reason-section">
            <summary class="ai-label">Why this tier?</summary>
            <p class="reason-text">{{ article.reason }}</p>
        </details>
        {% endif %}
    </aside>
    {% endif %}

    <div class="article-content">
        {{ article.content | default("No content extracted.") | safe }}
    </div>

    <footer class="article-actions-bar">
        <div class="feedback-buttons feedback-group-{{ article.id }}">
            {% if article.feedback == "approved" %}
            <span class="feedback-done">Clipping created</span>
            {% elif article.feedback == "skipped" %}
            <span class="feedback-done">Skipped</span>
            {% else %}
            <button hx-post="/article/{{ article.id }}/feedback?feedback=approved"
                    hx-target=".feedback-group-{{ article.id }}"
                    hx-swap="outerHTML"
                    class="btn-sm outline contrast">üëç Approve</button>
            <button hx-post="/article/{{ article.id }}/feedback?feedback=skipped"
                    hx-target=".feedback-group-{{ article.id }}"
                    hx-swap="outerHTML"
                    class="btn-sm outline contrast">üëé Skip</button>
            {% endif %}
        </div>
        <div class="nav-links">
            {% if prev_id %}
            <a href="/article/{{ prev_id }}{{ tier_param }}" role="button" class="outline contrast btn-sm">‚Üê Prev</a>
            {% endif %}
            <a href="/{{ '?tier=' + tier_filter if tier_filter else '' }}" role="button" class="outline contrast btn-sm">Feed</a>
            {% if next_id %}
            <a href="/article/{{ next_id }}{{ tier_param }}" role="button" class="outline contrast btn-sm">Next ‚Üí</a>
            {% endif %}
        </div>
    </footer>
</article>
{% endblock %}
